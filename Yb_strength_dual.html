<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>E1 Dipole Strength Emulator (dual view)</title>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/numeric/1.2.6/numeric.min.js"></script>
<style>
  html, body {
    margin: 0; padding: 0; width: 100%; height: 100%;
    font-family: system-ui,-apple-system,'Segoe UI',Roboto,Helvetica,Arial,sans-serif;
    background: #fff; overflow: hidden; display: flex; justify-content: center;
  }
  .page {
    width: 100%; height: 100%;
    max-width: 1100px;
    display: flex; flex-direction: column;
  }
  .row { display: flex; flex-direction: column; width: 100%; height: 100%; }
  #fig { flex: 1 1 auto; min-height: 0; border: none; }

  #panel {
    flex: 0 0 auto; border-bottom: 1px solid #e5e7eb; padding: 10px 14px;
    box-sizing: border-box; display: flex; gap: 18px; align-items: center;
  }
  #panel > div { flex: 1; }

  .label { font-size: 20px; color: #374151; display: block; margin-bottom: 2px; }
  .value { font-weight: 700; margin-left: 6px; font-size: 18px; }
  input[type="range"] { width: 100%; }

  .card {
    flex-basis: 420px; border: 1px solid #e5e7eb; border-radius: 12px; padding: 12px 16px;
    background: #fff; box-shadow: 0 1px 2px rgba(0,0,0,0.06);
  }
  .card-title { margin: 0 0 6px 0; font-size: 20px; color: #111827; font-weight: 800; }
  .big-value { font-size: 52px; font-weight: 900; letter-spacing: 0.2px; line-height: 1.05; }
  .unit { font-size: 22px; font-weight: 700; color: #374151; margin-left: 6px; vertical-align: middle; }
</style>
</head>
<body>
<div class="page">
  <div class="row">
    <div id="panel">
      <div>
        <span class="label">d<sub>TV</sub> <span id="alphaVal" class="value"></span></span>
        <input id="alpha" type="range" min="0.457" max="1.743" step="0.01" value="1.100">
      </div>
      <div>
        <span class="label">b<sub>TV</sub> (fm<sup>2</sup>) <span id="betaVal" class="value"></span></span>
        <input id="beta" type="range" min="1.500" max="4.000" step="0.01" value="2.750">
      </div>
      <div class="card">
        <p class="card-title">Predicted dipole polarizability</p>
        <div class="big-value" id="adVal">—<span class="unit">fm³</span></div>
      </div>
    </div>
    <div id="fig"></div>
  </div>
</div>

<script>
"use strict";
const DATA = {"D":[[4.085913181304932,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],[0.0,6.022841930389404,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],[0.0,0.0,6.4277729988098145,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],[0.0,0.0,0.0,9.343716621398926,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0,13.179034233093262,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0,0.0,10.947333335876465,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0,0.0,0.0,14.115029335021973,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0,0.0,0.0,0.0,15.3056640625,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,16.581052780151367,0.0,0.0,0.0,0.0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,17.893585205078125,0.0,0.0,0.0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,19.6119384765625,0.0,0.0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,19.11914825439453,0.0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,22.581436157226562,0.0,0.0,0.0],[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,28.3883113861084,0.0,0.0],[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,28.356746673583984,0.0],[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,27.407854080200195]],"S1":[[-8.413750648498535,-5.098840236663818,5.14590311050415,-2.631072998046875,0.3890685737133026,2.680996894836426,-0.131275475025177,1.4590225219726562,-4.725224494934082,7.513216495513916,5.180370330810547,-8.072112083435059,9.316314697265625,1.9918700456619263,5.292338848114014,1.995926856994629],[-5.098840236663818,-2.5657801628112793,0.24749426543712616,-1.107215166091919,-1.7282180786132812,2.0764503479003906,1.1074739694595337,1.6301798820495605,-6.0382561683654785,1.9445207118988037,0.159654438495636,-1.5132255554199219,0.09488220512866974,-0.24827350676059723,0.3251414895057678,0.48042845726013184],[5.14590311050415,0.24749426543712616,-2.539837121963501,1.581506371498108,-1.0968066453933716,-1.1398125886917114,1.9676032066345215,0.48182132840156555,0.5220276117324829,-2.6480791568756104,-3.432116985321045,3.3427584171295166,-1.9226300716400146,0.21023361384868622,0.21873806416988373,2.1248486042022705],[-2.631072998046875,-1.107215166091919,1.581506371498108,1.4792544841766357,0.8286656737327576,1.0595567226409912,-2.5317888259887695,0.8379708528518677,-3.3268964290618896,1.2723560333251953,0.2525871694087982,-0.215292289853096,-0.6105380058288574,0.20537914335727692,0.27184608578681946,0.7685621976852417],[0.3890685737133026,-1.7282180786132812,-1.0968066453933716,0.8286656737327576,0.015875542536377907,-0.5586926937103271,-1.7166109085083008,1.0517150163650513,-0.8313225507736206,-0.2776089608669281,-0.15451881289482117,1.5009956359863281,-3.5521481037139893,-0.20139524340629578,-0.2780263423919678,-0.9312136769294739],[2.680996894836426,2.0764503479003906,-1.1398125886917114,1.0595567226409912,-0.5586926937103271,0.34405696392059326,1.9416872262954712,-1.5562102794647217,1.0078380107879639,-0.34679704904556274,0.3168565630912781,2.719623565673828,0.40740612149238586,-0.4396650493144989,-1.8133527040481567,1.2998958826065063],[-0.131275475025177,1.1074739694595337,1.9676032066345215,-2.5317888259887695,-1.7166109085083008,1.9416872262954712,3.387932777404785,-1.5068490505218506,1.2875447273254395,1.3244154453277588,1.8486019372940063,-4.398312568664551,4.903109550476074,-2.636366844177246,1.2594475746154785,0.7009833455085754],[1.4590225219726562,1.6301798820495605,0.48182132840156555,0.8379708528518677,1.0517150163650513,-1.5562102794647217,-1.5068490505218506,-0.03943730890750885,0.22131352126598358,-1.71414315700531,-0.3299948275089264,1.289611577987671,-0.8007959127426147,0.6221040487289429,-1.1747140884399414,0.5198649168014526],[-4.725224494934082,-6.0382561683654785,0.5220276117324829,-3.3268964290618896,-0.8313225507736206,1.0078380107879639,1.2875447273254395,0.22131352126598358,-1.0595884323120117,2.2440943717956543,2.3134002685546875,-2.4608049392700195,1.5917298793792725,0.17173704504966736,0.9392876029014587,0.49994558095932007],[7.513216495513916,1.9445207118988037,-2.6480791568756104,1.2723560333251953,-0.2776089608669281,-0.34679704904556274,1.3244154453277588,-1.71414315700531,2.2440943717956543,-1.8485163450241089,-2.6715853214263916,2.915799617767334,-2.6718297004699707,-3.344757556915283,1.5731509923934937,-2.6487457752227783],[5.180370330810547,0.159654438495636,-3.432116985321045,0.2525871694087982,-0.15451881289482117,0.3168565630912781,1.8486019372940063,-0.3299948275089264,2.3134002685546875,-2.6715853214263916,0.5796642303466797,1.4280471801757812,0.21808084845542908,3.080587387084961,0.6510000824928284,-0.9148532748222351],[-8.072112083435059,-1.5132255554199219,3.3427584171295166,-0.215292289853096,1.5009956359863281,2.719623565673828,-4.398312568664551,1.289611577987671,-2.4608049392700195,2.915799617767334,1.4280471801757812,-2.845954418182373,1.0046868324279785,2.2539710998535156,-1.6819257736206055,-2.529585123062134],[9.316314697265625,0.09488220512866974,-1.9226300716400146,-0.6105380058288574,-3.5521481037139893,0.40740612149238586,4.903109550476074,-0.8007959127426147,1.5917298793792725,-2.6718297004699707,0.21808084845542908,1.0046868324279785,0.6006994843482971,2.935086965560913,0.6573554873466492,3.185176372528076],[1.9918700456619263,-0.24827350676059723,0.21023361384868622,0.20537914335727692,-0.20139524340629578,-0.4396650493144989,-2.636366844177246,0.6221040487289429,0.17173704504966736,-3.344757556915283,3.080587387084961,2.2539710998535156,2.935086965560913,3.6678359508514404,-0.479799747467041,-0.3700093626976013],[5.292338848114014,0.3251414895057678,0.21873806416988373,0.27184608578681946,-0.2780263423919678,-1.8133527040481567,1.2594475746154785,-1.1747140884399414,0.9392876029014587,1.5731509923934937,0.6510000824928284,-1.6819257736206055,0.6573554873466492,-0.479799747467041,-0.18190330266952515,0.14858722686767578],[1.995926856994629,0.48042845726013184,2.1248486042022705,0.7685621976852417,-0.9312136769294739,1.2998958826065063,0.7009833455085754,0.5198649168014526,0.49994558095932007,-2.6487457752227783,-0.9148532748222351,-2.529585123062134,3.185176372528076,-0.3700093626976013,0.14858722686767578,-2.1281898021698]],"S2":[[3.1571555137634277,1.3206349611282349,-1.2437219619750977,1.067941427230835,0.22317847609519958,-0.5704717040061951,0.5574833154678345,-1.1750026941299438,0.22735793888568878,-0.3161011338233948,-1.4910736083984375,2.306504964828491,-1.2212111949920654,1.2170662879943848,-0.26560869812965393,0.05039214342832565],[1.3206349611282349,2.883470058441162,1.023128867149353,0.6601419448852539,0.9398810863494873,-0.34453925490379333,-0.7979283332824707,-0.40081387758255005,0.9250308871269226,-0.12772154808044434,1.1976957321166992,0.10170011967420578,0.3282236158847809,-0.5318654775619507,1.4606647491455078,0.5298992395401001],[-1.2437219619750977,1.023128867149353,0.9869322776794434,-0.9168555736541748,-0.07806025445461273,0.599949836730957,-0.9533635973930359,0.20980720221996307,-0.34503427147865295,0.7381192445755005,0.018577443435788155,-0.23649294674396515,-0.22814033925533295,1.9524476528167725,1.123700737953186,2.3836121559143066],[1.067941427230835,0.6601419448852539,-0.9168555736541748,0.013437790796160698,0.19504927098751068,-0.5016608834266663,0.06574539095163345,-0.025721227750182152,0.8395481109619141,-1.0330581665039062,-0.16773909330368042,0.11356400698423386,-0.8046889305114746,-0.21248827874660492,-0.5375789403915405,-1.666971206665039],[0.22317847609519958,0.9398810863494873,-0.07806025445461273,0.19504927098751068,0.3811687231063843,0.08359126001596451,0.33229494094848633,-0.23378068208694458,0.07258915156126022,0.36668360233306885,-0.05261022970080376,-0.20914144814014435,1.034717321395874,-0.5707235336303711,0.19299441576004028,-0.12493986636400223],[-0.5704717040061951,-0.34453925490379333,0.599949836730957,-0.5016608834266663,0.08359126001596451,0.3038657605648041,-0.021915201097726822,0.3176244795322418,-0.28803685307502747,-0.5875504612922668,-0.07188638299703598,-0.3138304054737091,-0.04204211011528969,-0.6812840104103088,0.6270002722740173,0.6013903021812439],[0.5574833154678345,-0.7979283332824707,-0.9533635973930359,0.06574539095163345,0.33229494094848633,-0.021915201097726822,-1.1367383003234863,0.5598289966583252,-0.27244293689727783,0.014307527802884579,-0.42865532636642456,1.1021544933319092,-1.6580032110214233,-0.05235447362065315,-0.5712922811508179,-0.025320904329419136],[-1.1750026941299438,-0.40081387758255005,0.20980720221996307,-0.025721227750182152,-0.23378068208694458,0.3176244795322418,0.5598289966583252,0.22554746270179749,0.24774853885173798,0.29024413228034973,0.20853197574615479,-0.08010224997997284,0.7921508550643921,-0.41807854175567627,-0.2383567839860916,-0.641830563545227],[0.22735793888568878,0.9250308871269226,-0.34503427147865295,0.8395481109619141,0.07258915156126022,-0.28803685307502747,-0.27244293689727783,0.24774853885173798,0.32219403982162476,-0.25612351298332214,-0.6461296677589417,0.7828342318534851,-0.2907417118549347,-0.2959740161895752,-0.728752076625824,0.7638207077980042],[-0.3161011338233948,-0.12772154808044434,0.7381192445755005,-1.0330581665039062,0.36668360233306885,-0.5875504612922668,0.014307527802884579,0.29024413228034973,-0.25612351298332214,0.3136114478111267,1.4110612869262695,-0.7339262366294861,-0.15799172222614288,0.007161958608776331,0.048978835344314575,0.09097452461719513],[-1.4910736083984375,1.1976957321166992,0.018577443435788155,-0.16773909330368042,-0.05261022970080376,-0.07188638299703598,-0.42865532636642456,0.20853197574615479,-0.6461296677589417,1.4110612869262695,0.1073092520236969,-0.6539742350578308,-0.3423834443092346,-1.3098464012145996,-0.8231375813484192,0.9024340510368347],[2.306504964828491,0.10170011967420578,-0.23649294674396515,0.11356400698423386,-0.20914144814014435,-0.3138304054737091,1.1021544933319092,-0.08010224997997284,0.7828342318534851,-0.7339262366294861,-0.6539742350578308,1.185507893562317,0.4101884067058563,-0.9684671759605408,0.5504751205444336,-0.4050282835960388],[-1.2212111949920654,0.3282236158847809,-0.22814033925533295,-0.8046889305114746,1.034717321395874,-0.04204211011528969,-1.6580032110214233,0.7921508550643921,-0.2907417118549347,-0.15799172222614288,-0.3423834443092346,0.4101884067058563,-0.8382588028907776,-0.5347166061401367,0.039393626153469086,-1.5719627141952515],[1.2170662879943848,-0.5318654775619507,1.9524476528167725,-0.21248827874660492,-0.5707235336303711,-0.6812840104103088,-0.05235447362065315,-0.41807854175567627,-0.2959740161895752,0.007161958608776331,-1.3098464012145996,-0.9684671759605408,-0.5347166061401367,0.6693857312202454,0.3953495919704437,0.2634643018245697],[-0.26560869812965393,1.4606647491455078,1.123700737953186,-0.5375789403915405,0.19299441576004028,0.6270002722740173,-0.5712922811508179,-0.2383567839860916,-0.728752076625824,0.048978835344314575,-0.8231375813484192,0.5504751205444336,0.039393626153469086,0.3953495919704437,1.5571037530899048,0.14705808460712433],[0.05039214342832565,0.5298992395401001,2.3836121559143066,-1.666971206665039,-0.12493986636400223,0.6013903021812439,-0.025320904329419136,-0.641830563545227,0.7638207077980042,0.09097452461719513,0.9024340510368347,-0.4050282835960388,-1.5719627141952515,0.2634643018245697,0.14705808460712433,1.6536879539489746]],"S3":[[1.8653488159179688,0.8290116190910339,-0.5644139051437378,1.3990716934204102,-0.15544869005680084,0.09127169102430344,-0.42045795917510986,-0.33746999502182007,2.414297342300415,-1.9523451328277588,-0.5188100934028625,1.5924646854400635,-1.7267965078353882,0.4183472990989685,0.5826057195663452,-0.06599251925945282],[0.8290116190910339,0.9798017740249634,-1.9189555644989014,-0.35299238562583923,-0.18495996296405792,-0.3890272378921509,-0.5324990749359131,-0.227537140250206,2.5274345874786377,-1.3334641456604004,-1.190028429031372,0.5896530151367188,-0.2122848778963089,0.4926896393299103,0.2266414314508438,-1.2297682762145996],[-0.5644139051437378,-1.9189555644989014,1.9643741846084595,0.3938215374946594,1.0123683214187622,-0.13725268840789795,0.5214834809303284,-0.4389549493789673,-0.9419963955879211,1.5708036422729492,0.9882080554962158,-0.6104841232299805,0.9773234724998474,0.33340203762054443,0.7387222051620483,0.1138293519616127],[1.3990716934204102,-0.35299238562583923,0.3938215374946594,-0.44524896144866943,-0.09157954901456833,-6.845028838142753e-05,0.9354943037033081,-0.6434707641601562,1.5413037538528442,-0.30460307002067566,0.17341352999210358,0.4794265329837799,-0.09419432282447815,1.0872694253921509,1.1975526809692383,0.5529138445854187],[-0.15544869005680084,-0.18495996296405792,1.0123683214187622,-0.09157954901456833,0.023103076964616776,0.16104553639888763,0.294442743062973,-0.22358284890651703,0.1151738166809082,0.017680751159787178,0.27288222312927246,-0.12530875205993652,0.8956568241119385,0.4825100898742676,0.5375949144363403,0.2397615760564804],[0.09127169102430344,-0.3890272378921509,-0.13725268840789795,-6.845028838142753e-05,0.16104553639888763,-0.2450660914182663,-0.35040295124053955,0.20544686913490295,-0.38045835494995117,-0.05729341879487038,-0.02506168559193611,-0.34684017300605774,-0.45533332228660583,0.18099051713943481,0.05547695979475975,-0.7792707085609436],[-0.42045795917510986,-0.5324990749359131,0.5214834809303284,0.9354943037033081,0.294442743062973,-0.35040295124053955,-0.34857991337776184,0.22611024975776672,-0.31369271874427795,-0.5833367705345154,0.25203314423561096,0.8218846321105957,-1.0306347608566284,0.7487085461616516,0.25076955556869507,-0.12402314692735672],[-0.33746999502182007,-0.227537140250206,-0.4389549493789673,-0.6434707641601562,-0.22358284890651703,0.20544686913490295,0.22611024975776672,0.04223811626434326,-0.2502247393131256,0.618259608745575,-0.12164298444986343,-0.2998134195804596,0.3263947367668152,0.08838348090648651,-0.14620323479175568,0.04171765223145485],[2.414297342300415,2.5274345874786377,-0.9419963955879211,1.5413037538528442,0.1151738166809082,-0.38045835494995117,-0.31369271874427795,-0.2502247393131256,0.28888365626335144,-0.9328898191452026,-0.4531596302986145,0.8223420977592468,-0.926015317440033,-0.6709945797920227,-0.20454564690589905,0.413891464471817],[-1.9523451328277588,-1.3334641456604004,1.5708036422729492,-0.30460307002067566,0.017680751159787178,-0.05729341879487038,-0.5833367705345154,0.618259608745575,-0.9328898191452026,0.762266218662262,0.048478297889232635,-0.5293731093406677,1.1631475687026978,1.6679518222808838,0.8069535493850708,1.2672795057296753],[-0.5188100934028625,-1.190028429031372,0.9882080554962158,0.17341352999210358,0.27288222312927246,-0.02506168559193611,0.25203314423561096,-0.12164298444986343,-0.4531596302986145,0.048478297889232635,-0.13422362506389618,0.03622991591691971,0.5612719655036926,-0.1564456671476364,0.6317474246025085,-0.27593857049942017],[1.5924646854400635,0.5896530151367188,-0.6104841232299805,0.4794265329837799,-0.12530875205993652,-0.34684017300605774,0.8218846321105957,-0.2998134195804596,0.8223420977592468,-0.5293731093406677,0.03622991591691971,0.472488671541214,-0.6696187257766724,-0.8529738187789917,0.5352959036827087,0.719703197479248],[-1.7267965078353882,-0.2122848778963089,0.9773234724998474,-0.09419432282447815,0.8956568241119385,-0.45533332228660583,-1.0306347608566284,0.3263947367668152,-0.926015317440033,1.1631475687026978,0.5612719655036926,-0.6696187257766724,0.5493758320808411,-0.6856534481048584,-0.424401193857193,-0.23673994839191437],[0.4183472990989685,0.4926896393299103,0.33340203762054443,1.0872694253921509,0.4825100898742676,0.18099051713943481,0.7487085461616516,0.08838348090648651,-0.6709945797920227,1.6679518222808838,-0.1564456671476364,-0.8529738187789917,-0.6856534481048584,-1.706854224205017,1.2571927309036255,1.0234630107879639],[0.5826057195663452,0.2266414314508438,0.7387222051620483,1.1975526809692383,0.5375949144363403,0.05547695979475975,0.25076955556869507,-0.14620323479175568,-0.20454564690589905,0.8069535493850708,0.6317474246025085,0.5352959036827087,-0.424401193857193,1.2571927309036255,-1.1152362823486328,1.6185808181762695],[-0.06599251925945282,-1.2297682762145996,0.1138293519616127,0.5529138445854187,0.2397615760564804,-0.7792707085609436,-0.12402314692735672,0.04171765223145485,0.413891464471817,1.2672795057296753,-0.27593857049942017,0.719703197479248,-0.23673994839191437,1.0234630107879639,1.6185808181762695,-0.5456189513206482]],"v0":[-0.273348331451416,-0.31422656774520874,0.1049850732088089,1.18635892868042,4.155490875244141,1.4925612211227417,2.3321292400360107,3.465456485748291,1.9535099267959595,2.0615792274475098,1.858823299407959,2.5131940841674805,0.8832051157951355,-0.28588101267814636,-0.0504346527159214,0.12142322957515717],"v1":[0.07009666413068771,-0.25698375701904297,0.5565088391304016,0.34904956817626953,0.6071738004684448,0.0031556575559079647,0.906828761100769,-0.11431670933961868,0.5861362814903259,-0.27324241399765015,-0.45038098096847534,-0.8688217401504517,-0.09954586625099182,0.10005854070186615,2.1107051372528076,0.25230905413627625],"v2":[0.07524280995130539,0.40213799476623535,0.20135319232940674,0.1484411507844925,-0.47288697957992554,-0.012347654439508915,-0.22463171184062958,0.1803971529006958,-0.06882290542125702,0.48811599612236023,-0.12525130808353424,-0.24662727117538452,-0.11845932900905609,0.4286663234233856,-0.4820338487625122,0.45297786593437195],"fold":1.5727512836456299,"x1":1.2147901058197021,"x2":0.7190887928009033,"x3":-1.4751297235488892,"x4":0.6585590243339539,"omega":[0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,1.0,1.1,1.2,1.3,1.4,1.5,1.6,1.7,1.8,1.9,2.0,2.095,2.195,2.295,2.395,2.495,2.595,2.695,2.795,2.895,2.995,3.095,3.195,3.295,3.395,3.495,3.595,3.695,3.795,3.895,3.995,4.09,4.19,4.29,4.39,4.49,4.59,4.69,4.79,4.89,4.99,5.09,5.19,5.29,5.39,5.49,5.59,5.69,5.79,5.89,5.99,6.085,6.185,6.285,6.385,6.485,6.585,6.685,6.785,6.885,6.985,7.085,7.185,7.285,7.385,7.485,7.585,7.685,7.785,7.885,7.985,8.08,8.18,8.28,8.38,8.48,8.58,8.68,8.78,8.88,8.98,9.08,9.18,9.28,9.38,9.48,9.58,9.68,9.78,9.88,9.98,10.075,10.175,10.275,10.375,10.475,10.575,10.675,10.775,10.875,10.975,11.075,11.175,11.275,11.375,11.475,11.575,11.675,11.775,11.875,11.975,12.07,12.17,12.27,12.37,12.47,12.57,12.67,12.77,12.87,12.97,13.07,13.17,13.27,13.37,13.47,13.57,13.67,13.77,13.87,13.97,14.065,14.165,14.265,14.365,14.465,14.565,14.665,14.765,14.865,14.965,15.065,15.165,15.265,15.365,15.465,15.565,15.665,15.765,15.865,15.965,16.06,16.16,16.26,16.36,16.46,16.56,16.66,16.76,16.86,16.96,17.06,17.16,17.26,17.36,17.46,17.56,17.66,17.76,17.86,17.96,18.055,18.155,18.255,18.355,18.455,18.555,18.655,18.755,18.855,18.955,19.055,19.155,19.255,19.355,19.455,19.555,19.655,19.755,19.855,19.955,20.05,20.15,20.25,20.35,20.45,20.55,20.65,20.75,20.85,20.95,21.05,21.15,21.25,21.35,21.45,21.55,21.65,21.75,21.85,21.95,22.045,22.145,22.245,22.345,22.445,22.545,22.645,22.745,22.845,22.945,23.045,23.145,23.245,23.345,23.445,23.545,23.645,23.745,23.845,23.945,24.04,24.14,24.24,24.34,24.44,24.54,24.64,24.74,24.84,24.94,25.04,25.14,25.24,25.34,25.44,25.54,25.64,25.74,25.84,25.94,26.035,26.135,26.235,26.335,26.435,26.535,26.635,26.735,26.835,26.935,27.035,27.135,27.235,27.335,27.435,27.535,27.635,27.735,27.835,27.935,28.03,28.13,28.23,28.33,28.43,28.53,28.63,28.73,28.83,28.93,29.03,29.13,29.23,29.33,29.43,29.53,29.63,29.73,29.83,29.93,30.025,30.125,30.225,30.325,30.425,30.525,30.625,30.725,30.825,30.925,31.025,31.125,31.225,31.325,31.425,31.525,31.625,31.725,31.825,31.925,32.02,32.12,32.22,32.32,32.42,32.52,32.62,32.72,32.82,32.92,33.02,33.12,33.22,33.32,33.42,33.52,33.62,33.72,33.82,33.92,34.015,34.115,34.215,34.315,34.415,34.515,34.615,34.715,34.815,34.915,35.015,35.115,35.215,35.315,35.415,35.515,35.615,35.715,35.815,35.915,36.01,36.11,36.21,36.31,36.41,36.51,36.61,36.71,36.81,36.91,37.01,37.11,37.21,37.31,37.41,37.51,37.61,37.71,37.81,37.91,38.005,38.105,38.205,38.305,38.405,38.505,38.605,38.705,38.805,38.905,39.005,39.105,39.205,39.305,39.405,39.505,39.605,39.705,39.805,39.905],"w_lo":0.0,"w_hi":40.0,"retain":0.6,"alpha_min":0.457,"alpha_max":1.743,"beta_min":1.5,"beta_max":4.0,"alpha_c":1.1,"beta_c":2.75,"fac_alphaD":4.021199712055465};

/* ---------- small helpers ---------- */
function dot(a,b){ let s=0.0; for(let i=0;i<a.length;++i) s+=a[i]*b[i]; return s; }
function eigMatrix(E){ const M=(E&&E.x&&Array.isArray(E.x))?E.x:E; return M.map(r=>r.map(Number)); }
function keepWindow(n,retain){ const k=Math.max(1,Math.min(Math.round(retain*n),n)); const left=Math.floor((n-k)/2), right=left+k; return {left,right,k}; }
function rbColor(t){ const tmin=0.08,tmax=0.92,x=tmin+Math.min(1,Math.max(0,t))*(tmax-tmin); const stops=[[0.0,220,60,52],[0.5,128,64,128],[1.0,52,90,220]];
  let i=0; while(i+1<stops.length&&stops[i+1][0]<x)++i; const a=stops[i],b=stops[i+1]||stops[i];
  const f=(x-a[0])/Math.max(1e-9,(b[0]-a[0])); const r=Math.round(a[1]+f*(b[1]-a[1])), g=Math.round(a[2]+f*(b[2]-a[2])), bl=Math.round(a[3]+f*(b[3]-a[3]));
  return "rgb("+r+","+g+","+bl+")"; }

/* ---------- build M & v_eff (EM1 dipole) ---------- */
function buildM(alpha,beta){
  const n=DATA.D.length, da=alpha-DATA.alpha_c, db=beta-DATA.beta_c;
  const exp1=Math.exp(-da*DATA.x1);
  const M=new Array(n);
  for(let i=0;i<n;++i){
    const row=new Array(n);
    for(let j=0;j<n;++j){
      row[j]=DATA.D[i][j] + da*DATA.S1[i][j] + db*DATA.S2[i][j] + db*exp1*DATA.S3[i][j];
    }
    M[i]=row;
  }
  for(let i=0;i<n;++i) for(let j=i+1;j<n;++j){ const s=0.5*(M[i][j]+M[j][i]); M[i][j]=s; M[j][i]=s; }
  return M;
}
function buildVeff(alpha,beta){
  const da=alpha-DATA.alpha_c, db=beta-DATA.beta_c;
  const n=DATA.v0.length, v=new Array(n);
  for(let i=0;i<n;++i) v[i]=DATA.v0[i] + da*DATA.v1[i] + db*DATA.v2[i];
  return v;
}
function lorentzianStrength(omega, eigs, B, width){
  const W=omega, S=new Array(W.length), g=width/2.0/Math.PI, g2=(width*width)/4.0;
  for(let j=0;j<W.length;++j){
    const w=W[j]; let s=0.0;
    for(let i=0;i<eigs.length;++i){ const dw=w-eigs[i]; s+=B[i]*g/(dw*dw+g2); }
    S[j]=s;
  }
  return S;
}

/* ---------- α_D and width ---------- */
function computeAlphaD(eigs,B){
  let sum=0.0;
  for(let i=0;i<eigs.length;++i){
    const Ei=eigs[i];
    if(Ei>1.0) sum += B[i] / Ei;
  }
  return DATA.fac_alphaD * sum; // fm^3
}
function widthEff(alpha,beta){
  const da=alpha-DATA.alpha_c, db=beta-DATA.beta_c;
  const core=DATA.x2 + DATA.x3*da + DATA.x4*db;
  return Math.sqrt(DATA.fold*DATA.fold + core*core);
}

/* ---------- spectrum + tracks ---------- */
function computeStrengthAndEig(alpha,beta){
  const M=buildM(alpha,beta), EIG=numeric.eig(M);
  const vals0=Array.from(EIG.lambda.x).map(Number), EV=eigMatrix(EIG.E);
  const order=vals0.map((v,i)=>[v,i]).sort((a,b)=>a[0]-b[0]).map(p=>p[1]);
  const vals=order.map(i=>vals0[i]), vecs=EV.map(r=>order.map(i=>r[i]));
  const win=keepWindow(vals.length, DATA.retain);
  const kept_vals=vals.slice(win.left,win.right), kept_vecs=vecs.map(r=>r.slice(win.left,win.right));
  const v_eff=buildVeff(alpha,beta);
  const fE=[], fB=[];
  for(let i=0;i<kept_vals.length;++i){
    const Ei=kept_vals[i];
    if(Ei>-5 && Ei<60){
      const vi=new Array(kept_vecs.length); for(let r=0;r<kept_vecs.length;++r) vi[r]=kept_vecs[r][i];
      const proj=dot(vi,v_eff); fE.push(Ei); fB.push(proj*proj);
    }
  }
  const Gamma=widthEff(alpha,beta);
  const W=DATA.omega, S=lorentzianStrength(W, fE, fB, Gamma);
  const S_at_E=lorentzianStrength(fE, fE, fB, Gamma);
  return {S, eigs:fE, B:fB, S_eigs:S_at_E, kept_count:win.k};
}
function computeEigentracks(beta,NV){
  const V0s=numeric.linspace(DATA.alpha_min, DATA.alpha_max, NV);
  let E0=numeric.eig(buildM(V0s[0],beta)); let v0s=Array.from(E0.lambda.x).map(Number);
  const ord0=v0s.map((v,i)=>[v,i]).sort((a,b)=>a[0]-b[0]).map(p=>p[1]); v0s=ord0.map(i=>v0s[i]);
  const n=v0s.length, win=keepWindow(n,DATA.retain);
  const Y=new Array(n); for(let i=0;i<n;++i) Y[i]=new Array(V0s.length);
  for(let j=0;j<V0s.length;++j){
    const E=numeric.eig(buildM(V0s[j],beta)); let vals=Array.from(E.lambda.x).map(Number);
    const ord=vals.map((v,i)=>[v,i]).sort((a,b)=>a[0]-b[0]).map(p=>p[1]); vals=ord.map(i=>vals[i]);
    for(let i=0;i<n;++i) Y[i][j]=vals[i];
  }
  let ymin=+1e9, ymax=-1e9; for(let i=win.left;i<win.right;++i) for(let j=0;j<V0s.length;++j){ const v=Y[i][j]; if(v<ymin) ymin=v; if(v>ymax) ymax=v; }
  const pad=0.08*(ymax-ymin||1.0); ymin-=pad; ymax+=pad;
  const traces_grey=[], traces_kept=[];
  function pushGrey(i){ traces_grey.push({x:V0s,y:Y[i],mode:"lines",type:"scattergl",line:{width:1.2,color:"rgba(120,120,120,0.45)",dash:"dot"},hoverinfo:"skip",showlegend:false,xaxis:"x2",yaxis:"y2"}); }
  for(let i=0;i<win.left;++i) pushGrey(i); for(let i=win.right;i<n;++i) pushGrey(i);
  for(let idx=0,i=win.left;i<win.right;++i,++idx){ const c=rbColor(idx/Math.max(1,win.k-1));
    traces_kept.push({x:V0s,y:Y[i],mode:"lines",type:"scattergl",line:{width:2.0,color:c},hoverinfo:"skip",showlegend:false,xaxis:"x2",yaxis:"y2"});
  }
  return {V0s, traces_kept, traces_grey, ymin, ymax, k:win.k};
}
function buildEigenLines(eigs,heights,k){ const lines=[]; for(let i=0;i<eigs.length;++i){ const ci=Math.min(k-1,i);
  lines.push({x:[eigs[i],eigs[i]],y:[0,Math.min(15,heights[i])],mode:"lines",type:"scatter",line:{width:2,color:rbColor(ci/Math.max(1,k-1))},hoverinfo:"skip",showlegend:false,xaxis:"x",yaxis:"y"}); } return lines; }
function assembleData(a,b,top,tracks){
  const topLine={x:DATA.omega,y:top.S,mode:"lines",type:"scattergl",line:{width:4,color:"black"},xaxis:"x",yaxis:"y"};
  const marker={x:[a,a],y:[tracks.ymin,tracks.ymax],mode:"lines",type:"scatter",line:{color:"black",width:3},hoverinfo:"skip",showlegend:false,xaxis:"x2",yaxis:"y2"};
  return [topLine, ...buildEigenLines(top.eigs.filter(w=>w>=DATA.w_lo&&w<=DATA.w_hi), top.S_eigs, tracks.k), ...tracks.traces_grey, ...tracks.traces_kept, marker];
}

/* ---------- initial build ---------- */
const NV_TRACKS=81, NV_TRACKS_FAST=49, NV_TRACKS_FINE=101, BETA_FAST_DEBOUNCE_MS=80, BETA_FINE_DELAY_MS=120;
let top0=computeStrengthAndEig(DATA.alpha_c,DATA.beta_c);
let tracks=computeEigentracks(DATA.beta_c,NV_TRACKS);
let lastTopPack=top0;

const layout={autosize:true, margin:{l:72,r:36,t:28,b:72}, paper_bgcolor:"white", plot_bgcolor:"white",
  grid:{rows:2,columns:1,pattern:"independent",roworder:"top to bottom",rowheights:[0.54,0.46]}, font:{size:18},
  xaxis:{ title:{text:"ω (MeV)", font:{size:22}}, range:[DATA.w_lo,DATA.w_hi], tickfont:{size:18}, gridcolor:"rgba(0,0,0,0.10)"},
  yaxis:{ title:{text:"S(ω) (fm²/MeV)", font:{size:22}}, range:[0,15], tickfont:{size:18}, gridcolor:"rgba(0,0,0,0.10)"},
  xaxis2:{ title:{text:"d<sub>TV</sub>", font:{size:22}}, range:[DATA.alpha_min,DATA.alpha_max], tickfont:{size:18}, gridcolor:"rgba(0,0,0,0.10)"},
  yaxis2:{ title:{text:"Eigenvalue (MeV)", font:{size:22}}, tickfont:{size:18}, gridcolor:"rgba(0,0,0,0.10)", range:[tracks.ymin,tracks.ymax]},
  showlegend:false };

Plotly.newPlot("fig", assembleData(DATA.alpha_c, DATA.beta_c, top0, tracks), layout, {displaylogo:false, scrollZoom:true, responsive:true})
.then(gd=>{
  const alphaEl=document.getElementById("alpha");
  const betaEl =document.getElementById("beta");
  const alphaVal=document.getElementById("alphaVal");
  const betaVal =document.getElementById("betaVal");
  const adVal  =document.getElementById("adVal");

  function setValues(a,b){ alphaVal.textContent=a.toFixed(2); betaVal.textContent=b.toFixed(2); }
  function setAlphaD(pack){ const val=computeAlphaD(pack.eigs, pack.B); adVal.innerHTML = (isFinite(val)? val.toFixed(2) : "—") + '<span class="unit">fm³</span>'; }

  setValues(parseFloat(alphaEl.value), parseFloat(betaEl.value));
  setAlphaD(lastTopPack);

  function updateTopTraces(pack){
    return [{x:DATA.omega,y:pack.S,mode:"lines",type:"scattergl",line:{width:4,color:"black"},xaxis:"x",yaxis:"y"},
            ...buildEigenLines(pack.eigs.filter(w=>w>=DATA.w_lo&&w<=DATA.w_hi), pack.S_eigs, tracks.k)];
  }

  function onAlphaInput(){
    const a=parseFloat(alphaEl.value), b=parseFloat(betaEl.value);
    setValues(a,b);
    lastTopPack=computeStrengthAndEig(a,b);
    setAlphaD(lastTopPack);
    const topTraces=updateTopTraces(lastTopPack);
    const markerIndex=gd.data.length-1;
    const bottom=gd.data.slice(topTraces.length,markerIndex).concat([gd.data[markerIndex]]);
    Plotly.react(gd, topTraces.concat(bottom), gd.layout);
    Plotly.restyle(gd, {x:[[a,a]]}, [markerIndex]);
  }

  let betaTimerFast=null, betaTimerFine=null;
  function recomputeTracksDebounced(nv,delayMs){
    if(betaTimerFast) window.clearTimeout(betaTimerFast);
    betaTimerFast=window.setTimeout(()=>{
      const a=parseFloat(alphaEl.value), b=parseFloat(betaEl.value);
      const newTracks=computeEigentracks(b,nv); tracks=newTracks;
      const newLayout=Object.assign({},gd.layout, {yaxis2:Object.assign({},gd.layout.yaxis2,{range:[tracks.ymin,tracks.ymax]})});
      Plotly.react(gd, assembleData(a,b,lastTopPack,tracks), newLayout);
    }, delayMs);
  }
  function refineTracksAfterRelease(){ if(betaTimerFine) window.clearTimeout(betaTimerFine); betaTimerFine=window.setTimeout(()=>{recomputeTracksDebounced(NV_TRACKS_FINE,0);}, BETA_FINE_DELAY_MS); }

  function onBetaInput(){
    const a=parseFloat(alphaEl.value), b=parseFloat(betaEl.value);
    setValues(a,b);
    lastTopPack=computeStrengthAndEig(a,b);
    setAlphaD(lastTopPack);
    const topTraces=updateTopTraces(lastTopPack);
    const markerIndex=gd.data.length-1;
    const bottom=gd.data.slice(topTraces.length,markerIndex).concat([gd.data[markerIndex]]);
    Plotly.react(gd, topTraces.concat(bottom), gd.layout);
    recomputeTracksDebounced(NV_TRACKS_FAST, BETA_FAST_DEBOUNCE_MS);
  }

  alphaEl.addEventListener("input", onAlphaInput);
  betaEl.addEventListener("input", onBetaInput);
  betaEl.addEventListener("change", refineTracksAfterRelease);
});
</script>
</body>
</html>
